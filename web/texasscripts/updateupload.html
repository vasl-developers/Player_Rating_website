<!DOCTYPE html>
<html lang="en">

<head>
    <title>Edit Players</title>
    <meta http-equiv="expires" content="0">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-responsive.css" rel="stylesheet">
    <link href="../css/style.css?counter=<?php echo time(); ?>" rel="stylesheet">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
</head>
<body >
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="http://www.texas-asl.com">Texas ASL</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li id="about"><a href="http://www.texas-asl.com/bladder/addPlayer.php"><i class="icon-repeat icon-white"></i> Add Player</a></li>
                    <li id="about"><a href="http://www.texas-asl.com/bladder/phone.php"><i class="icon-repeat icon-white"></i> Phone List</a></li>
                    <li id="admin"><a href="http://www.texas-asl.com:2082/3rdparty/phpMyAdmin/index.php"><i class="icon-cog icon-white"></i> Admin</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row-fluid">
        <div id="homeContainer" class="span12">
            <?php

$playerName = $_GET['playerName'];
$first = $_GET['first'];
$last = $_GET['last'];
$phone1 = $_GET['phone1'];
$phone2 = $_GET['phone2'];
$phone3 = $_GET['phone3'];
$email = $_GET['email'];
$city = $_GET['city'];
$inactive = $_GET['inactive'];
$mode = $_GET['mode'];

if ($mode == "") {
$playerName = $_POST['playerName'];
$first = $_POST['first'];
$last = $_POST['last'];
$phone1 = $_POST['phone1'];
$phone2 = $_POST['phone2'];
$phone3 = $_POST['phone3'];
$email = $_POST['email'];
$city = $_POST['city'];
$inactive = $_POST['inactive'];
$mode = $_POST['mode'];
}

include "connection.php";
$link = mysqli_connect($host, $username, $password, $database);

function ckNullEmpty($data) {
if ($data === NULL || $data === 'NULL' || $data === 'null' || $data === '') {
return "&nbsp;";
}

return $data;
}

//add mode adds a form
if ($mode == "add") {
Print '<h2>Add Player</h2>
            <p>
            <form action="http://www.texas-asl.com/bladder/editPlayer.php" method="post">
                <table>
                    <tr><td>First Name:</td><td><input type="text" name="first" /></td></tr>
                    <tr><td>Last Name:</td><td><input type="text" name="last" /></td></tr>
                    <tr><td>Phone1:</td><td><input type="text" name="phone1" /></td></tr>
                    <tr><td>Phone2:</td><td><input type="text" name="phone2" /></td></tr>
                    <tr><td>Phone3:</td><td><input type="text" name="phone3" /></td></tr>
                    <tr><td>Email:</td><td><input type="text" name="email" /></td></tr>
                    <tr><td>City:</td><td><input type="text" name="city" /></td></tr>
                    <tr><td>Inactive:</td><td><input type="text" name="inactive" /></td></tr>
                    <tr><td align="center"><input type="submit" /></td></tr>
                    <input type=hidden name=mode value=added>
                </table>
            </form> <p>';
            }

            //added mode adds the data
            if ($mode == "added") {
            if ($first > "") {
            $query = "INSERT INTO Player (Name,first_name,last_name,phone1,phone2,phone3,email,city,inactive,points,wins,losses,ties,streak,streak_type) VALUES ('$first $last','$first','$last','$phone1','$phone2','$phone3','$email','$city',0,1000,0,0,0,0,'x')";
            mysqli_query($link, $query);
            }
            }

            //edit mode adds a pre-populated form
            if ($mode == "edit") {
            Print '<h2>Edit Player</h2>
            <p>
            <form action="http://www.texas-asl.com/bladder/editPlayer.php" method="post">
                <table>
                    <tr><td>First Name:</td><td><input type="text" value="';
Print $first;
print '" name="first" /></td></tr>

                    <tr><td>Last Name:</td><td><input type="text" value="';
Print $last;
print '" name="last" /></td></tr>

                    <tr><td>Phone1:</td><td><input type="text" value="';
Print $phone1;
print '" name="phone1" /></td></tr>

                    <tr><td>Phone2:</td><td><input type="text" value="';
Print $phone2;
print '" name="phone2" /></td></tr>

                    <tr><td>Phone3:</td><td><input type="text" value="';
Print $phone3;
print '" name="phone3" /></td></tr>

                    <tr><td>Email:</td><td><input type="text" value="';
Print $email;
print '" name="email" /></td></tr>

                    <tr><td>City:</td><td><input type="text" value="';
Print $city;
print '" name="city" /></td></tr>

                    <tr><td>Inactive:</td><td><input type="text" value="';
Print $inactive;
print '" name="inactive" />(0 = false, 1 = true)</td></tr>

                    <tr><td align="center"><input type="submit" /></td></tr>
                    <input type=hidden name=mode value=edited>
                    <input type=hidden name=playerName value="';
Print $playerName;
print '">
                </table>
            </form> <p>';
            }

            //edited mode updates the data for a given playerName
            if ($mode == "edited") {
            if ($first > "") {
            $query = "update Player set Name = '$first $last', first_name = '$first', last_name = '$last', phone1 = '$phone1', phone2 = '$phone2', phone3 = '$phone3', email = '$email', city = '$city', inactive = 0 where Name = '$playerName'";
            $result = mysqli_query($link, $query);
            Print "Data Updated!<p>";
            } else {
            $query = "delete from Player where Name == ''";
            mysqli_query($link, $query);
            Print "Record Deleted!<p>";
            }
            }

            //This pulls the data and puts it into an array, then prints in alphabetical order based on name
            $data = mysqli_query($link, "SELECT * FROM Player ORDER BY first_name ASC") or die(mysqli_error());
            Print "<h2>Player List</h2><p>";
            Print "<table border cellpadding=3>";
            Print "
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Phone1</th>
                <th>Phone2</th>
                <th>Phone3</th>
                <th>Email</th>
                <th>City</th>
                <th>Inactive</th>
                <th>Admin</th>
            </tr>";
            Print "<td colspan=9 align=right><a href=" . $_SERVER['PHP_SELF'] . "?mode=add>Add Player</a></td>";
            while ($info = mysqli_fetch_array($data)) {
            $nm = ckNullEmpty($info['Name']);
            $fn = ckNullEmpty($info['first_name']);
            $ln = ckNullEmpty($info['last_name']);
            $p1 = ckNullEmpty($info['phone1']);
            $p2 = ckNullEmpty($info['phone2']);
            $p3 = ckNullEmpty($info['phone3']);
            $em = ckNullEmpty($info['email']);
            $ct = ckNullEmpty($info['city']);
            $ia = ckNullEmpty($info['inactive']);
            if ($ia == 1) {
            $iaText = "Inactive";
            }

            if ($ia == 0) {
            $iaText = "";
            }

            Print "<tr>\n";
                Print "<td>" . $fn . "</td>";
                Print "<td>" . $ln . "</td>";
                Print "<td>" . $p1 . "</td>";
                Print "<td>" . $p2 . "</td>";
                Print "<td>" . $p3 . "</td>";
                Print "<td>" . $em . "</td>";
                Print "<td>" . $ct . "</td>";
                Print "<td>" . $iaText . "</td>";
                Print "<td><a href=" . $_SERVER['PHP_SELF'] . "?playerName=" . urlencode($nm) . "&first=" . urlencode($fn) . "&last=" .
urlencode($ln) . "&phone1=" . urlencode($p1) . "&phone2=" . urlencode($p2) . "&phone3=" . urlencode($p3) . "&email=" . $em . "&city=" . urlencode($ct) . "&inactive=" . urlencode($ia) .
"&mode=edit>Edit</a></td>";
                Print "</tr>\n";
            }
            Print "</table>";
            ?>
        </div>
    </div>
</div>
</body>
</html>
